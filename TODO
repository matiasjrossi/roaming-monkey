Features requeridos:
- Agregar los parámetros de on-call qualify/qualifyfreq HECHO
- Agregar como parámetro del servidor el nombre de archivo en el que se configuran los clientes SIP HECHO
- Usar los parámetros de on-call qualify/qualifyfreq HECHO
- Arreglar los parámetros de on-call qualify/qualifyfreq HECHO



- Verificar y debuguear ====================== HECHO


- Levantar off-call qualify/qualifyfreq de la configuración del usuario

Lo último que hiciste fue ordenar las claves del mapa del evento respuesta a getconfig.
Tenés que levantar los valores, matcheando con una regexp y no te olvides de setear los user como 'ready'
Además tenes que asegurarte que al desqualificar use los valores del mapa.


- Buscar la forma de compactar el archivo de configuración
- Arreglar FIXMEs
- Buscar la forma de recargar solo sip cuando se cambian los parámetros
- Hacer login via handshake
- DOCUMENTAR ;)
- Revisar TODOS en el archivo de configuracion y pulirlo para ejemplo final
- Arreglar el script start/stop
- Verborrasearla como chango cuando tengo los siguientes errores:
	* Relacionados con SIP_CONF_FILENAME:
		- AMI Error: Config file not found
		- AMI Error: Config file has invalid format
		(...)
- Poder activar debug on-demand desde el archivo de configuración (no desde la linea de comandos)

- FIX: "WARNING  :: AsteriskManagerFactory.clientConnectionLost :: Connection Lost to pbx.dojo at localhost:5038 -- Connection to the other side was lost in a non-clean fashion: Connection lost."
- Manejar este error: "ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully"
Nice-to-haves:
- Comunicarse con asterisk sobre un tunel SSL 

############## NUEVO BUG!!! #####################
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerBridge :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey._askStatus :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey._askStatus :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: User 207 is being monitored in server pbx.dojo.
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Starting qualification...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.qualify :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.setQualify :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Storing channels...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: User 206 is being monitored in server pbx.dojo.
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Starting qualification...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.qualify :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.setQualify :: Running...
[Mon May 23 13:07:15 2011] DEBUG    :: Monkey.handlerStatus :: Storing channels...
[Mon May 23 13:07:15 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Mon May 23 13:07:15 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Mon May 23 13:07:15 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Mon May 23 13:07:15 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Mon May 23 13:07:26 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:07:26 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:07:36 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:07:54 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:07:55 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:08 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:18 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:31 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerPeerStatus :: User 206 disconnected from server pbx.dojo. Verifying status...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerPeerStatus :: Trying to redirect...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.redirect :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.redirect :: Executing "Redirect SIP/207-00000817 to (internal : 0303456 : 1)...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerUnlink :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerUnlink :: User 206 is being monitored in server pbx.dojo.
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerUnlink :: Stopping qualification...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.unqualify :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.setQualify :: Running...
[Mon May 23 13:08:34 2011] DEBUG    :: Monkey.handlerUnlink :: Clearing channels...
[Mon May 23 13:08:49 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:08:49 2011] DEBUG    :: Monkey.handlerPeerStatus :: User 207 disconnected from server pbx.dojo. Verifying status...
[Mon May 23 13:08:49 2011] DEBUG    :: Monkey.handlerPeerStatus :: Trying to redirect...
[Mon May 23 13:08:49 2011] DEBUG    :: Monkey.redirect :: Running...
[Mon May 23 13:08:49 2011] DEBUG    :: Monkey.redirect :: Executing "Redirect SIP/206-00000816 to (internal : 0223155328357 : 1)...
[Mon May 23 13:08:49 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Channel does not exist: SIP/206-00000816
[Mon May 23 13:09:22 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:22 2011] DEBUG    :: Monkey.handlerPeerStatus :: User 207 disconnected from server pbx.dojo. Verifying status...
[Mon May 23 13:09:22 2011] DEBUG    :: Monkey.handlerPeerStatus :: Trying to redirect...
[Mon May 23 13:09:22 2011] DEBUG    :: Monkey.redirect :: Running...
[Mon May 23 13:09:22 2011] DEBUG    :: Monkey.redirect :: Executing "Redirect SIP/206-00000816 to (internal : 0223155328357 : 1)...
ACA!!! NO DEBERIA PASAR ESTO!!!
[Mon May 23 13:09:22 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Channel does not exist: SIP/206-00000816

[Mon May 23 13:09:24 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:24 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:24 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:25 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:41 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:09:41 2011] DEBUG    :: Monkey.handlerPeerStatus :: User 206 disconnected from server pbx.dojo. Verifying status...
[Mon May 23 13:09:41 2011] DEBUG    :: Monkey.handlerPeerStatus :: User 206 is not in a conversation (talking_with = None).
[Mon May 23 13:10:17 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:10:27 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:10:30 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
[Mon May 23 13:10:30 2011] DEBUG    :: Monkey.handlerPeerStatus :: Running...
######################################################

#################### LOG
[Tue May 10 12:52:10 2011] INFO     :: Starting...
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela :: Initializing...
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela.initialize :: Running... 
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela.parseConfig :: Parsing config
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela.start :: Starting Avarahamela...
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela.onAuthenticationAccepted :: Running for Server pbx.dojo
[Tue May 10 12:52:10 2011] DEBUG    :: Avarahamela._askStatus :: Running...
[Tue May 10 12:52:22 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:52:29 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:52:31 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:52:36 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela._askStatus :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela._askStatus :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerStatus :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: User 206 is being monitored in server pbx.dojo.
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: Starting qualification...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.qualify :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.setQualify :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: Storing channels...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerStatus :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: User 207 is being monitored in server pbx.dojo.
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: Starting qualification...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.qualify :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.setQualify :: Running...
[Tue May 10 12:52:40 2011] DEBUG    :: Avarahamela.handlerBridge :: Storing channels...
[Tue May 10 12:52:40 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Tue May 10 12:52:40 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Tue May 10 12:52:40 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Tue May 10 12:52:40 2011] ERROR    :: AsteriskManagerProtocol.processMessageBuffer (Server: pbx.dojo) :: AMI Error: Delete did not complete successfully
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: User 207 disconnected from server pbx.dojo. Verifying status...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Trying to redirect...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.redirect :: Running...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.redirect :: Executing "Redirect SIP/206-00000369 to (internal : 0223155328357 : 1)...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerUnlink :: Running...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerUnlink :: User 207 is being monitored in server pbx.dojo.
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerUnlink :: Stopping qualification...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.unqualify :: Running...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.setQualify :: Running...
[Tue May 10 12:53:15 2011] DEBUG    :: Avarahamela.handlerUnlink :: Clearing channels...
[Tue May 10 12:53:24 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerBridge :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela._askStatus :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela._askStatus :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerStatus :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerStatus :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerBridge :: User 206 is being monitored in server pbx.dojo.
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerBridge :: Starting qualification...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.qualify :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.setQualify :: Running...
[Tue May 10 12:53:31 2011] DEBUG    :: Avarahamela.handlerBridge :: Storing channels...
[Tue May 10 12:53:33 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:53:33 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:54:01 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:54:06 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:54:19 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: User 206 disconnected from server pbx.dojo. Verifying status...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Trying to redirect...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.redirect :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.redirect :: Executing "Redirect SIP/convergia-0000036a to (internal : 0303456 : 1)...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerUnlink :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerUnlink :: User 206 is being monitored in server pbx.dojo.
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerUnlink :: Stopping qualification...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.unqualify :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.setQualify :: Running...
[Tue May 10 12:54:35 2011] DEBUG    :: Avarahamela.handlerUnlink :: Clearing channels...
[Tue May 10 12:54:36 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:55:07 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:55:07 2011] DEBUG    :: Avarahamela.handlerPeerStatus :: Running...
[Tue May 10 12:55:12 2011] WARNING  :: AsteriskManagerFactory.clientConnectionLost :: Connection Lost to pbx.dojo at localhost:5038 -- Connection to the other side was lost in a non-clean fashion: Connection lost.
[Tue May 10 12:55:12 2011] DEBUG    :: Avarahamela :: Finished...
##############################################


################
qualify = 1000
qualifyfreq = 1
################




Action: Login
Username: avarahamela
Secret: avarahamela
Events: off

Action: Logoff


Action: UpdateConfig
Reload: no
SrcFilename: sip.conf
DstFilename: sip.conf
Action-000000: Delete
Cat-000000: 207
Var-000000: qualify

Action: UpdateConfig
Reload: yes
SrcFilename: sip.conf
DstFilename: sip.conf
Action-000000: Delete
Cat-000000: 207
Var-000000: qualifyfreq


Action: UpdateConfig
Reload: no
SrcFilename: sip.conf
DstFilename: sip.conf
Action-000000: Append
Cat-000000: 207
Var-000000: qualify
Value-000000: 1000

Action: UpdateConfig
Reload: yes
SrcFilename: sip.conf
DstFilename: sip.conf
Action-000000: Append
Cat-000000: 207
Var-000000: qualifyfreq
Value-000000: 1





Action: GetConfig
ActionID: 33934
Filename: sip.conf
Category: 206



Action: GetConfig
ActionID: 33934
Filename: sip.conf
Category: 207




Action: GetConfig
ActionID: 33934
Filename: sip.conf
Category: 209

